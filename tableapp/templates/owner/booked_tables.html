{% load custom_filters %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booked Tables</title>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Chakra Petch', sans-serif;
        }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        function showBookingDetails(tableId, index) {
            const bookings = document.querySelectorAll(`#bookings-${tableId} .booking`);
            bookings.forEach((booking, idx) => {
                booking.classList.toggle('hidden', idx !== index);
            });
        }
    </script>
</head>

<body class="bg-gray-100">
    {% include 'owner/admin_nav.html' %}

    <h1 class="text-center text-3xl font-bold mt-6 mb-8">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏ï‡πä‡∏∞‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏á</h1>
    <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for table in table_data %}
        <div class="border rounded-lg shadow bg-white p-4 relative">
            <div class="flex justify-between items-center">
                <h2 class="text-xl font-bold text-gray-700">{{ table.table_name }}</h2>
                <div class="bg-blue-500 text-white text-sm font-bold px-2 py-1 rounded-full">
                    {{ table.bookings|length }} ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
                </div>
            </div>
            <p class="text-sm text-gray-600">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏: {{ table.seating_capacity }} ‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á</p>
            <hr class="my-2">

            <div id="bookings-{{ table.table_name }}">
                {% for booking in table.bookings %}
                <div class="booking {% if not forloop.first %}hidden{% endif %}">
                    <h3 class="font-bold text-gray-600">üìå ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á:</h3>
                    <p class="text-sm text-gray-500">
                        ‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á: {{ booking.user.username }} <br>
                        ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: {{ booking.booking_date|date:"d/m/Y" }} <br>
                        ‡πÄ‡∏ß‡∏•‡∏≤: {{ booking.booking_time|date:"H:i" }} - {{ booking.booking_end_time|date:"H:i" }} <br>
                        ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <span class="status-text">
                            {% if booking.status == "pending" %}
                                <span class="text-yellow-500 font-bold">‡∏£‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</span>
                            {% elif booking.status == "occupied" %}
                                <span class="text-green-500 font-bold">‡∏°‡∏µ‡∏Ñ‡∏ô‡∏ô‡∏±‡πà‡∏á</span>
                            {% elif booking.status == "completed" %}
                                <span class="text-blue-500 font-bold">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</span>
                            {% elif booking.status == "cancelled" %}
                                <span class="text-red-500 font-bold">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</span>
                            {% endif %}
                        </span>
                    </p>

                    <!-- ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡πÉ‡∏ä‡πâ Form) -->
                    {% if booking.status == "pending" %}
                    <form method="POST" action="{% url 'change_booking_status' booking.id %}">
                        {% csrf_token %}
                        <input type="hidden" name="status" value="occupied">
                        <button type="submit" class="bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2">
                            ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                        </button>
                    </form>
                    {% endif %}

                    {% if booking.status == "occupied" %}
                    <form method="POST" action="{% url 'change_booking_status' booking.id %}">
                        {% csrf_token %}
                        <input type="hidden" name="status" value="completed">
                        <button type="submit" class="bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2">
                            ‚úîÔ∏è ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
                        </button>
                    </form>
                    {% endif %}
                </div>
                {% endfor %}
            </div>

            {% if table.bookings|length > 1 %}
            <div class="flex justify-between mt-4">
                <button onclick="showBookingDetails('{{ table.table_name }}', 0)" 
                    class="bg-gray-300 px-2 py-1 rounded hover:bg-gray-400">‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
                <button onclick="showBookingDetails('{{ table.table_name }}', 1)" 
                    class="bg-gray-300 px-2 py-1 rounded hover:bg-gray-400">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</body>

</html>
