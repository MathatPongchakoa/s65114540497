<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Status</title>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- ‚úÖ Popup ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß -->
    <div id="booking-warning" class="hidden fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-50">
        <div class="bg-white p-6 rounded-lg shadow-lg text-center">
            <h2 class="text-lg font-bold text-red-600">‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡πÇ‡∏ï‡πä‡∏∞‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß!</h2>
            <p class="text-gray-700 mt-2">‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á 1 ‡πÇ‡∏ï‡πä‡∏∞ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô</p>
            <button onclick="closeBookingPopup()" class="mt-4 px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>
    <!-- Popup ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ -->
    <div id="date-time-warning" class="hidden fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-50">
        <div class="bg-white p-6 rounded-lg shadow-lg text-center">
            <h2 class="text-lg font-bold text-red-600">‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤!</h2>
            <p class="text-gray-700 mt-2">‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</p>
            <button onclick="closeDateTimePopup()" class="mt-4 px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>
    <div id="table-booked-warning" class="hidden fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-50">
        <div class="bg-white p-6 rounded-lg shadow-lg text-center">
            <h2 class="text-lg font-bold text-red-600">‚ö†Ô∏è ‡πÇ‡∏ï‡πä‡∏∞‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß!</h2>
            <p class="text-gray-700 mt-2">‡πÇ‡∏ï‡πä‡∏∞‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞‡∏≠‡∏∑‡πà‡∏ô</p>
            <button onclick="closeTableBookedPopup()" class="mt-4 px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>

    
    <script>
        function openTableBookedPopup() {
            document.getElementById("table-booked-warning").classList.remove("hidden");
        }

        function closeTableBookedPopup() {
            document.getElementById("table-booked-warning").classList.add("hidden");
        }
        
        function openDateTimePopup() {
            document.getElementById("date-time-warning").classList.remove("hidden");
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î‡∏õ‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏û‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤
        function closeDateTimePopup() {
            document.getElementById("date-time-warning").classList.add("hidden");
        }
        // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î popup
        function openBookingPopup() {
            document.getElementById("booking-warning").classList.remove("hidden");
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î popup
        function closeBookingPopup() {
            document.getElementById("booking-warning").classList.add("hidden");
        }

    
        // ‡πÉ‡∏ä‡πâ window.onload ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ popup ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
        function handleTableClick(event, isBooked, hasActiveBooking) {
            event.preventDefault();

            // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
            const selectedDate = document.getElementById("selectedDate").value;
            const selectedTime = document.getElementById("selectedTime").value;

            if (!selectedDate || !selectedTime) {
                openDateTimePopup(); // ‡πÅ‡∏à‡πâ‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤
                return;
            }

            // ‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
            if (hasActiveBooking) {
                openBookingPopup();
                return;
            }

            // ‡∏ñ‡πâ‡∏≤‡πÇ‡∏ï‡πä‡∏∞‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏Ñ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            if (isBooked) {
                openTableBookedPopup();
            } else {
                event.target.closest("form").submit(); // ‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏ï‡πä‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏á
            }
        }
            
        // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏á‡πÇ‡∏ã‡∏ô
        function filterZone() {
            const selectedZone = document.getElementById("zoneFilter").value;
            const url = new URL(window.location.href);
            if (selectedZone) {
                url.searchParams.set("zone", selectedZone);
            } else {
                url.searchParams.delete("zone");
            }
            window.location.href = url.toString();
        }
    
        // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏û‡πÇ‡∏ã‡∏ô
        function openZonePopup(imageUrl, zoneName, description) {
            const popup = document.getElementById("zonePopup");
            const popupImage = document.getElementById("popupImage");
            const popupTitle = document.getElementById("popupTitle");
            const popupDescription = document.getElementById("popupDescription");
    
            popupImage.src = imageUrl;
            popupTitle.textContent = zoneName;
            popupDescription.textContent = description;
    
            popup.classList.remove("hidden");
        }
    
        // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î‡∏õ‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏û‡πÇ‡∏ã‡∏ô
        function closeZonePopup() {
            document.getElementById("zonePopup").classList.add("hidden");
        }
    
        // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
        function checkBookingStatus(isBooked) {
            if (isBooked) {
                openBookingPopup();  // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏û‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞‡πÅ‡∏•‡πâ‡∏ß
            }
        }
    </script>
    

    <style>
        /* ‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå Chakra Petch ‡∏ó‡∏±‡πà‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤ */
        body {
            font-family: 'Chakra Petch', sans-serif;
        }
    </style>
</head>

<body class="bg-gray-100">
    <!-- Navbar -->
    {% include 'user_nav.html' %}

    <!-- Alpine.js -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <div class="max-w-7xl mx-auto mt-6 flex flex-col items-center space-y-4">
        <h2 class="text-xl font-bold text-center">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÇ‡∏ï‡πä‡∏∞‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á</h2>
        <form method="GET" action="{% url 'table_status' %}" class="flex space-x-4">
            <input type="date" name="date" id="selectedDate" value="{{ selected_date|default:'' }}" class="border border-gray-300 p-2 rounded">
            <input type="time" name="time" id="selectedTime" value="{{ selected_time|default:'' }}" class="border border-gray-300 p-2 rounded">
            <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏ï‡πä‡∏∞‡∏ß‡πà‡∏≤‡∏á
            </button>
        </form>
    </div>

    <!-- Filters -->
    <div class="max-w-7xl mx-auto mt-6 flex items-center justify-between w-full">
        <!-- ‚úÖ ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞ (Legend) -->
        <div class="flex space-x-4">
            <div class="flex items-center">
                <div class="w-4 h-4 bg-yellow-100 border border-gray-300"></div>
                <span class="ml-2 text-sm text-gray-700">‡∏ô‡∏≠‡∏Å‡∏£‡πâ‡∏≤‡∏ô üçÉ</span>
            </div>
            <div class="flex items-center">
                <div class="w-4 h-4 bg-orange-100 border border-gray-300"></div>
                <span class="ml-2 text-sm text-gray-700">‡∏£‡∏¥‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á üåä</span>
            </div>
            <div class="flex items-center">
                <div class="w-4 h-4 bg-red-200 border border-gray-300"></div>
                <span class="ml-2 text-sm text-gray-700">‡πÉ‡∏ô‡∏£‡πâ‡∏≤‡∏ô üè†</span>
            </div>
        </div>

        <!-- ‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ã‡∏ô -->
        <div class="flex items-center space-x-4">
            <label for="zoneFilter" class="text-gray-700 font-bold">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ã‡∏ô:</label>
            <select id="zoneFilter" class="border border-gray-300 rounded p-2" onchange="filterZone()">
                <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                {% for zone in zones %}
                <option value="{{ zone.id }}" {% if selected_zone and selected_zone.id == zone.id %}selected{% endif %}>{{ zone.name }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <!-- Popup ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô -->
    <div id="zonePopup" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-lg p-6 relative max-w-xl">
            <button onclick="closeZonePopup()" class="absolute top-2 right-2 text-gray-500 hover:text-black">‚úñ</button>
            <h2 id="popupTitle" class="text-2xl font-bold text-center mb-4"></h2>
            <img id="popupImage" src="" alt="Zone Image" class="rounded shadow-lg max-w-full">
            <p id="popupDescription" class="text-gray-700 text-center mt-4"></p>
        </div>
    </div>

    <!-- Table Display -->
    <div class="max-w-7xl mx-auto grid grid-cols-3 items-start gap-6 mt-6">
        <!-- ‚úÖ ‡∏™‡πà‡∏ß‡∏ô "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏ï‡πä‡∏∞" ‡πÅ‡∏¢‡∏Å‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å -->
        <div class="col-span-3 w-full flex justify-center">
            <h1 class="text-center text-3xl font-bold mt-6 mb-8">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏ï‡πä‡∏∞</h1>
        </div>

        <!-- ‚úÖ ‡∏£‡∏π‡∏õ‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡πÇ‡∏ï‡πä‡∏∞ -->
        <div class="p-4 flex justify-center">
            <img src="/static/images/backk.png" alt="Table Layout Guide" class="rounded-lg shadow-lg w-full max-w-sm">
        </div>

        <!-- ‚úÖ ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÇ‡∏ï‡πä‡∏∞ -->
        <div class="col-span-2">
            <!-- ‚úÖ ‡πÅ‡∏ñ‡∏ö‡∏™‡∏µ (Legend) -->
            <div class="flex space-x-4 mb-4">
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-[#259b24] border border-gray-300"></div>
                    <span class="ml-2 text-sm text-gray-700">‡∏ß‡πà‡∏≤‡∏á</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-[#E22427] border border-gray-300"></div>
                    <span class="ml-2 text-sm text-gray-700">‡∏°‡∏µ‡∏Ñ‡∏ô‡∏ô‡∏±‡πà‡∏á</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-[#fbc02d] border border-gray-300"></div>
                    <span class="ml-2 text-sm text-gray-700">‡∏à‡∏≠‡∏á</span>
                </div>
            </div>

            <!-- ‚úÖ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÇ‡∏ï‡πä‡∏∞ -->
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-4 gap-y-2 place-items-center">
                {% for table in table_data %}
                <div class="p-4 rounded-lg text-center shadow-lg
                    {% if table.zone == '‡∏ô‡∏≠‡∏Å‡∏£‡πâ‡∏≤‡∏ô' %} bg-yellow-100
                    {% elif table.zone == '‡∏£‡∏¥‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á' %} bg-orange-100
                    {% elif table.zone == '‡πÉ‡∏ô‡∏£‡πâ‡∏≤‡∏ô' %} bg-red-200
                    {% else %} bg-green-200 {% endif %}">
                    
                    <form method="POST" action="{% url 'booking' table.table_name %}">
                        {% csrf_token %}
                        <input type="hidden" name="date" value="{{ selected_date }}">
                        <input type="hidden" name="time" value="{{ selected_time }}">
                        
                        <!-- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
                        <button type="submit" onclick="handleTableClick(event, {% if table.table_status == 'booked' or table.table_status == 'occupied' %}true{% else %}false{% endif %}, {% if has_active_booking %}true{% else %}false{% endif %})">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" class="cursor-pointer w-40 h-40 md:w-44 md:h-44">
                                <circle cx="100" cy="100" r="50"
                                    {% if table.table_status == 'available' %} fill="#259b24"
                                    {% elif table.table_status == 'occupied' %} fill="#E22427"
                                    {% elif table.table_status == 'booked' %} fill="#fbc02d"
                                    {% endif %} />
                                <text x="100" y="105" text-anchor="middle" fill="white" font-size="14" font-weight="bold">
                                    {{ table.table_name }}
                                </text>
                                {% for chair in table.chairs %}
                                <circle cx="{{ chair.x }}" cy="{{ chair.y }}" r="10" fill="#ddd" stroke="black" stroke-width="1" />
                                {% endfor %}
                            </svg>
                        </button>
                    </form>
                    
                    
            
                    <!-- ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏ã‡∏ô -->
                    <p class="text-gray-700 font-semibold mt-2">
                        {% if table.zone %}
                            Zone: {{ table.zone }}
                        {% else %}
                            ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÇ‡∏ã‡∏ô
                        {% endif %}
                    </p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</body>

</html>
