<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Status</title>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    
    <!-- ‚úÖ Popup ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß -->
    <div id="booking-warning" class="hidden fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-50">
        <div class="bg-white p-6 rounded-lg shadow-lg text-center">
            <h2 class="text-lg font-bold text-red-600">‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡πÇ‡∏ï‡πä‡∏∞‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß!</h2>
            <p class="text-gray-700 mt-2">‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á 1 ‡πÇ‡∏ï‡πä‡∏∞ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô</p>
            <button onclick="closeBookingPopup()" class="mt-4 px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>
    
    <div id="table-booked-warning" class="hidden fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-50">
        <div class="bg-white p-6 rounded-lg shadow-lg text-center">
            <h2 class="text-lg font-bold text-red-600">‚ö†Ô∏è ‡πÇ‡∏ï‡πä‡∏∞‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß!</h2>
            <p class="text-gray-700 mt-2">‡πÇ‡∏ï‡πä‡∏∞‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞‡∏≠‡∏∑‡πà‡∏ô</p>
            <button onclick="closeTableBookedPopup()" class="mt-4 px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>

    
    <script>
        function submitTableBooking(tableId, tableName, selectedDate, selectedTime, hasActiveBooking, tableStatus) {
            event.preventDefault(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥

            console.log(`üìå ‡∏Å‡∏î‡∏ó‡∏µ‡πà‡πÇ‡∏ï‡πä‡∏∞ ${tableName} (ID: ${tableId}) - ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${tableStatus}`);

            // ‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î Popup ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            if (hasActiveBooking) {
                console.warn("‚õî ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß!");
                openBookingPopup();
                return;
            }

            // ‡∏ñ‡πâ‡∏≤‡πÇ‡∏ï‡πä‡∏∞‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "booked" ‡∏´‡∏£‡∏∑‡∏≠ "occupied" ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î popup ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            if (tableStatus === "booked" || tableStatus === "occupied") {
                console.warn("‚ö†Ô∏è ‡πÇ‡∏ï‡πä‡∏∞‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏Ñ‡∏ô‡∏ô‡∏±‡πà‡∏á!");
                openTableBookedPopup();
                return;
            }

            // ‡∏´‡∏≤ Form ‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞‡∏ó‡∏µ‡πà‡∏Å‡∏î
            let form = document.getElementById(`booking-form-${tableId}`);
            if (!form) {
                console.error("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏ï‡πä‡∏∞‡∏ô‡∏µ‡πâ");
                return;
            }

            console.log("‚úÖ ‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á...");
            form.submit(); // ‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞
        }
        function openTableBookedPopup() {
            document.getElementById("table-booked-warning").classList.remove("hidden");
        }

        function closeTableBookedPopup() {
            document.getElementById("table-booked-warning").classList.add("hidden");
        }

    
        // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î popup
        function openBookingPopup() {
            document.getElementById("booking-warning").classList.remove("hidden");
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î popup
        function closeBookingPopup() {
            document.getElementById("booking-warning").classList.add("hidden");
        }

    
        // ‡πÉ‡∏ä‡πâ window.onload ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ popup ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
        
            
        // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏á‡πÇ‡∏ã‡∏ô
        function filterZone() {
            const selectedZone = document.getElementById("zoneFilter").value;
            const url = new URL(window.location.href);
            if (selectedZone) {
                url.searchParams.set("zone", selectedZone);
            } else {
                url.searchParams.delete("zone");
            }
            window.location.href = url.toString();
        }
    
      
        
        document.addEventListener("DOMContentLoaded", function () {
        let today = new Date().toISOString().split("T")[0];  // ‡∏î‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö YYYY-MM-DD
        let dateInput = document.getElementById("selectedDate");

        if (dateInput) {
            dateInput.setAttribute("min", today);  // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á
            if (!dateInput.value) {
                dateInput.value = today;  // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            }
        }
    });
    </script>
    

    <style>  
        body {
            font-family: 'Chakra Petch', sans-serif;
        }
        .table-area {
            width: 100%;
            height: 100vh; 
            background-image: url('static\images\backk.png');
            background-size: contain; 
            background-position: center;
            background-repeat: no-repeat; 
            overflow: hidden; 
        }

    </style>
</head>

<body class="bg-gray-100">
    <!-- Navbar -->
    {% include 'user_nav.html' %}

    <!-- Alpine.js -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <div class="max-w-7xl mx-auto mt-6 flex flex-col items-center space-y-4">
        <h2 class="text-xl font-bold text-center">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÇ‡∏ï‡πä‡∏∞‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á</h2>
        <form method="GET" action="{% url 'table_status' %}" class="flex space-x-4">
            <input type="date" name="date" id="selectedDate" value="{{ selected_date|default:'' }}" 
                   class="border border-gray-300 p-2 rounded" required>
        
            <input type="time" name="time" id="selectedTime" value="{{ selected_time|default:'' }}" 
                   class="border border-gray-300 p-2 rounded">
        
            <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏ï‡πä‡∏∞‡∏ß‡πà‡∏≤‡∏á
            </button>
        </form>
        
        
    </div>

    <!-- Filters -->
    <div class="max-w-7xl mx-auto mt-6 flex items-center justify-between w-full">
        <!-- ‚úÖ ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞ (Legend) -->
        <div class="flex space-x-4 mb-4">
            <div class="flex items-center">
                <div class="w-4 h-4 bg-[#259b24] border border-gray-300"></div>
                <span class="ml-2 text-sm text-gray-700">‡∏ß‡πà‡∏≤‡∏á</span>
            </div>
            <div class="flex items-center">
                <div class="w-4 h-4 bg-[#E22427] border border-gray-300"></div>
                <span class="ml-2 text-sm text-gray-700">‡∏°‡∏µ‡∏Ñ‡∏ô‡∏ô‡∏±‡πà‡∏á</span>
            </div>
            <div class="flex items-center">
                <div class="w-4 h-4 bg-[#fbc02d] border border-gray-300"></div>
                <span class="ml-2 text-sm text-gray-700">‡∏à‡∏≠‡∏á</span>
            </div>
        </div>

        <!-- ‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ã‡∏ô -->
        <div class="flex items-center space-x-4">
            <label for="zoneFilter" class="text-gray-700 font-bold">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ã‡∏ô:</label>
            <select id="zoneFilter" class="border border-gray-300 rounded p-2" onchange="filterZone()">
                <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                {% for zone in zones %}
                <option value="{{ zone.id }}" {% if selected_zone and selected_zone.id == zone.id %}selected{% endif %}>{{ zone.name }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <!-- Popup ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô -->
    <div id="zonePopup" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-lg p-6 relative max-w-xl">
            <button onclick="closeZonePopup()" class="absolute top-2 right-2 text-gray-500 hover:text-black">‚úñ</button>
            <h2 id="popupTitle" class="text-2xl font-bold text-center mb-4"></h2>
            <img id="popupImage" src="" alt="Zone Image" class="rounded shadow-lg max-w-full">
            <p id="popupDescription" class="text-gray-700 text-center mt-4"></p>
        </div>
    </div>

    <!-- Table Display -->
    
        <!-- ‚úÖ ‡∏™‡πà‡∏ß‡∏ô "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏ï‡πä‡∏∞" ‡πÅ‡∏¢‡∏Å‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å -->
        <div class="col-span-3 w-full flex justify-center">
            <h1 class="text-center text-3xl font-bold mt-6 mb-8">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏ï‡πä‡∏∞</h1>
        </div>


        <!-- ‚úÖ ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÇ‡∏ï‡πä‡∏∞ -->
        <div class="col-span-2">
            

            <!-- ‚úÖ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÇ‡∏ï‡πä‡∏∞ -->
            <svg class="table-area" id="table-layout" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000">
                {% for table in table_data %}
                <g id="table-{{ table.table_id }}" 
                    transform="translate({{ table.x_position }}, {{ table.y_position }})"
                    data-table-id="{{ table.table_id }}"
                    onclick="submitTableBooking('{{ table.table_id }}', '{{ table.table_name }}', '{{ selected_date }}', '{{ selected_time }}', {% if has_active_booking %}true{% else %}false{% endif %}, '{{ table.table_status }}')">
                    
                    <!-- ‚úÖ ‡∏Å‡∏£‡∏≠‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÇ‡∏ï‡πä‡∏∞ -->
                    <rect x="50" y="50" width="150" height="160" rx="10" ry="10" fill="none" stroke="#D97706" stroke-width="2"/>
            
                    <!-- ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞ -->
                    <circle cx="125" cy="115" r="40"
                        {% if table.table_status == 'available' %} fill="#259b24"
                        {% elif table.table_status == 'occupied' %} fill="#E22427"
                        {% elif table.table_status == 'booked' %} fill="#fbc02d"
                        {% endif %} />
            
                    <!-- ‚úÖ ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏ï‡πä‡∏∞ -->
                    <text x="125" y="120" text-anchor="middle" fill="white" font-size="14" font-weight="bold">
                        {{ table.table_name }}
                    </text>
            
                    <!-- ‚úÖ ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏à‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà -->
                    <foreignObject x="55" y="160" width="140" height="40">
                        <form id="booking-form-{{ table.table_id }}" method="POST" action="{% url 'booking' table.table_name %}">
                            {% csrf_token %}
                            <input type="hidden" name="date" id="hidden-date-{{ table.table_id }}" value="{{ selected_date }}">
                            <input type="hidden" name="time" id="hidden-time-{{ table.table_id }}" value="{{ selected_time }}">
                        </form>
                        
                    </foreignObject>
                </g>
                {% endfor %}
            </svg>
            
        </div>
    
</body>

</html>
